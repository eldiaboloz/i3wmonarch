#!/bin/bash
mpcdata=$(echo -ne "status\ncurrentsong\nclose\n" | nc localhost 6600)
if [[ $? != 0 ]]; then
    exit
fi
case $BLOCK_BUTTON in
    # 1-2-3 left-middle-right mouse button
    1) ~/dev/i3wmonarch/bin/audioplayer_control toggle 2>/dev/null 1>&2;;
    2) ~/dev/i3wmonarch/bin/youtube_currentsong 2>/dev/null 1>&2 ;;
    3) ~/dev/i3wmonarch/bin/audioplayer_control next 2>/dev/null 1>&2;;
    4) ~/dev/i3wmonarch/bin/audioplayer_control seeki 2>/dev/null 1>&2;;
    5) ~/dev/i3wmonarch/bin/audioplayer_control seekd 2>/dev/null 1>&2;;
esac

curmode=$(echo "$mpcdata" | grep "state:" | cut -d ' ' -f2-) 
case $curmode in
    stop)
        echo -n " "
        ;;
    play)
        echo -n " "
        ;;
    pause)
        echo -n " "
        ;;
esac
cursong=$(echo "$mpcdata" | grep "file:" | cut -d ' ' -f2-)
maxlen="${curcmussonglenlimit:-35}"
curslen=${#cursong}
if [ "$curslen" -gt "$maxlen" ]; then
 delta=$((($(date +%-S))%($curslen-$maxlen+1)))
 cursong="${cursong:($delta):$maxlen}"
fi
songtotal=$(echo "$mpcdata" | grep "duration:" | head -n 1 | cut -d ' ' -f2- | cut -d '.' -f1)
songcurrent=$(echo "$mpcdata" | grep "elapsed:" | cut -d ' ' -f2- | cut -d '.' -f1)

printf '%s %02d:%02d / %02d:%02d\n' "$cursong" $(($songcurrent/60)) $(($songcurrent%60)) $(($songtotal/60)) $(($songtotal%60))
#echo $cursong
#colorR=$(printf "%02X" $((0+$RANDOM%256)))
#colorG=$(printf "%02X" $((0+$RANDOM%256)))
#colorB=$(printf "%02X" $((0+$RANDOM%256)))
#echo "#$colorR$colorG$colorB"


blink=$(($(date "+%-S")%8))
case "$blink" in
    0) colorrgb="#0BDD94";;
    1) colorrgb="#E16725";;
    2) colorrgb="#E5E913";;
    3) colorrgb="#008DFF";;
    4) colorrgb="#FF0041";;
    5) colorrgb="#22FEE0";;
    6) colorrgb="#E4E4E4";;
    7) colorrgb="#FFD59C";;
    *) colorrgb="#FFFFFF";;
esac
echo "$colorrgb"
